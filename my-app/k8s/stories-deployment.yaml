apiVersion: apps/v1
kind: Deployment
metadata:
  name: stories-microservice
  labels:
    app: stories-microservice
spec:
  replicas: 1
  selector:
    matchLabels:
      app: stories-microservice
  template:
    metadata:
      labels:
        app: stories-microservice
    spec:
      containers:
      - name: stories-microservice
        image: my-app-backend-stories:latest
        imagePullPolicy: Never
        ports:
        - containerPort: 8080
        env:
        - name: MYSQL_DATABASE
          value: myapp_db  # Nome del database
        - name: MYSQL_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              name: db-credentials  # Secret con la password del root
              key: root_password     # Chiave per la password del root
        - name: MYSQL_USER
          valueFrom:
            secretKeyRef:
              name: db-credentials   # Secret con la password dell'utente
              key: username          # Chiave per il nome utente
        - name: MYSQL_PASSWORD
          valueFrom:
            secretKeyRef:
              name: db-credentials   # Secret con la password dell'utente
              key: password          # Chiave per la password dell'utente
        - name: MYSQL_HOST
          value: "db"  # Nome del servizio del database
        - name: MYSQL_PORT
          value: "3306"  # Porta del database
